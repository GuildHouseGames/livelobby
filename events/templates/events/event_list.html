{% extends 'base.html' %}

{% load static %}

{% block title %}Guild's LiveLobby{% endblock %}

{% block navbar_buttons %}
  <li class="hide-on-med-and-down">
    <a class="waves-effect waves-light blue btn" href="
      {% if user.is_authenticated %} 
          {% url 'create_event_view' %}
      {% else %}
          {% url 'login' %}
      {% endif %}">
      {% if user.is_authenticated %} 
          Create Event
      {% else %}
          Login
      {% endif %}
    </a>
  </li>
{% endblock %}

{% block side_menu_button %}
  <a href="#" data-target="mobile-nav" class="right sidenav-trigger show-on-large">
      <i class="material-icons">menu</i>
  </a>
{% endblock %}

{% block side_menu_content %}
  {% if user.is_authenticated %}
    <!--Show login details-->
    <li>
      <div class="user-view">
        <div class="background">
          <img style="opacity: 0.3;" src="{% static 'events/pizza.jpg' %}">
        </div>
        <!-- Default user image https://goo.gl/images/fdsMBc -->
        <img class="circle" src="{% static 'events/default_user.png' %}">
        <span class="text name">{{ user.display_name }}</span>
        <span class="text email">{{ user.email }}</span>
      </div>
    </li>

    <!--Menu items (for logged in users)-->
    <li>
      <a href="
        {% if user.is_authenticated %} 
            {% url 'create_event_view' %}
        {% endif %}">
        Create Event <i class="material-icons">add</i>
      </a>
    </li>
    <li>
      <a href="{% url 'logout' %}">
        Logout <i class="material-icons">exit_to_app</i>
      </a>
    </li>
  {% else %}
    <!--Show login links-->
    <li>
      <a href="{% url 'login' %}">
        Login with Social Media <i class="material-icons">account_box</i>
      </a>
    </li>
    <li>
      <a href="{% url 'login' %}">
        Login with LiveLobby <i class="material-icons">account_box</i>
      </a>
    </li>
  {% endif %}
{% endblock %}

{% block js_scripts %}
  <!--Activates sidenav-->
  <script>
      $(document).ready(function(){
          $('.sidenav').sidenav({'edge': 'right'});
      });
  </script>
{% endblock %}

{% block content %}
  <!--Old cards, but keep the floating button at the bottom-->
  <head>
    <!--Only makes use of events-container and event styles-->
    <link rel="stylesheet" type="text/css" href="{% static 'events/event_list.css' %}">
  </head>

  <!--Events Container Card-->
  <div class="events-container bg-secondary">
    {% for event in events %}
      <div class="card">
        <div class="card-content" >
          <div class="row center-align">
              <div class="col s3 card-title grey-text text-darken-4">
                  {{ event.time | time_string }}
              </div>
              <div class="col s6 card-title grey-text text-darken-4">
                {{ event.name }}
                  {% if event.is_booked%}
                    <i class="material-icons green-text">verified_user</i>
                  {% endif %}
              </div>
              <div class="col s3 card-title grey-text text-darken-4">
                  {% if event.get_engagement_type == 'COMPETITIVE'%}
                    <span class="red-text">{{ event.get_engagement_type_display }}</span>
                  {% else %}
                    <span class="blue-text">{{ event.get_engagement_type_display }}</span>
                  {% endif %}
              </div>
          </div>
          <div class="row center-align">
              <div class="col s3 card-title grey-text text-darken-4">
                  {{ event.date | date_string}}
              </div>
              <div class="col s6 card-title grey-text text-darken-6">
                  {{ event.host.display_name}}
              </div>
              <div class="col s3 card-title grey-text text-darken-4">
                  Players: {{ event|reserved_places }}/{{ event.max_size }}
              </div>
          </div>
            <div class="row center-align">
              <div class="col s3 card-title grey-text text-darken-6">
                  {{event.date.year}}
              </div>
              <div class="col s6">
                {{ event.description }}
              </div>
                <div class="col s3 card-title grey-text text-darken-4">
                    {% if user.is_authenticated %}
                        {% if event.host == user%}
                            <a class="waves-effect waves-light btn red"  href="{% url 'cancel_view' pk=event.pk %}">Cancel Event</a>
                        {% elif event|is_joined:user%}
                            <a class="waves-effect waves-light btn blue"  href="{% url 'leave_view' pk=event.pk %}">Leave</a>
                        {% else %}
                            {% if event|reserved_places < event.max_size %}
                                <a class="waves-effect waves-light btn blue" href="{% url 'join_view' event_id=event.id %}">Join</a>
                            {% else %}
                                <button type="button" class="btn red disabled">FULL</button>
                            {% endif %}
                        {% endif %}
                    {% else %}
                        {% if event|reserved_places < event.max_size %}
                            <a class="waves-effect waves-light btn blue" href="{% url 'login' %}">Join</a>
                        {% else %}
                            <button type="button" class="btn red disabled">FULL</button>
                        {% endif %}
                    {% endif %}
              </div>
          </div>
        </div>
      </div>
      {% empty %}
        <div class="card-panel blue white-text center-align">
          There are no current events... why not make your own?
        </div>
      {% endfor %}
    </div>
    <!-- Floating button -->
    {% if user.is_authenticated %}
      <div class="fixed-action-btn">
          <a class="btn-floating btn-large blue" href="{% url 'create_event_view' %}">
            <i class="large material-icons">add</i>
          </a>
      </div>
    {% endif %}

{% endblock %}
